:PROPERTIES:
:ID:       265c7aba-5b14-4101-8221-7ff017ab8153
:END:
#+SETUPFILE: blog.org
#+filetags: :aws:c4:architecture:documentation:
#+TITLE: Documentation as Code for Cloud - C4 Model
#+CREATED: 2023-07-17
#+HUGO_DRAFT: true

* Config                                                    :noexport:
This are some configuration variables for C4

#+name: puml-dir
#+begin_src emacs-lisp :exports none :var filename=""
(princ (concat "/cs/priv/repos/blog/static/posts/img/2023/documentation-as-code/" filename))
#+end_src

#+name: puml-code-dir
#+begin_src emacs-lisp :exports none :var filename=""
(princ (concat "/cs/priv/repos/blog/static/code/2023/documentation-as-code/plantuml/" filename))
#+end_src

#+begin_src emacs-lisp
(setq-local company-backends '(company-dabbrev company-files)
            company-dabbrev-other-buffers t
            company-dabbrev-ignore-case nil
            company-dabbrev-downcase nil)
#+end_src

* Introduction
In the last post, I've used PlantUML to draw things like *groups*, *accounts*, and *clusters*. However, I didn't focus on how
different parts inside the business layer interact (usually components related to the main application/system relevant
for your business). Now, we'll use a DSL
#+begin_sidenote
Domain-Specific Language specific for this use case
#+end_sidenote
to show these interactions between /components/, /services/, and /systems/. I'll use the *C4 model* to show the same system in *different ways* based on who we're showing it to. It allows us to adjust how much detail we include.

* C4 Model
:PROPERTIES:
:header-args: :exports none :results none
:END:

The C4 model was developed by [[https://simonbrown.je/][Simon Brown]] as a means of providing a *visual map* of system components across *four levels
of abstraction*, as suggested by its title. Each level of abstraction in the C4 model suits different *audiences*, from the
non-technical management level to detailed developer perspectives, each level of abstraction is tailored to meet its
observer's understanding. To maintain consistency when describing the system design, the C4 model uniformly applies the same terminology and abstractions across all its levels, effectively implementing ubiquitous language principles from Domain-Driven Design ({{{zk_topic(ddd,DDD)}}}).

#+caption: C4 model summary
#+begin_src plantuml :file (org-sbe puml-dir (filename \"c4-summary.png\"))
@startwbs
+ Level 1\nSoftware System
++ Level 2\nContainer
++ Level 2\nContainer
++ Level 2\nContainer
+++ Level 3\nComponent
+++ Level 3\nComponent
++++ Level 4\nCode
++++ Level 4\nCode
@endwbs
#+end_src

#+html: {{< gbox src="/posts/img/2023/documentation-as-code/c4-summary.png" title="The 4 perspectives in the C4 model" caption="The 4 perspectives in the C4 model" pos="left" >}}

** Abstractions
The C4 model uses [[https://c4model.com/#Abstractions][abstractions]] to form an hierarchy of well-defined diagrams (at different levels). Currently these
abstractions are available:

1. *Person*
   - Represents human users interacting with the system (e.g., Administrator, End User, Customer).

2. *System*
   - A top-level view showing different people interacting with different software systems. (e.g., E-commerce Platform,
     Payment Gateway, our self-destructing email service ðŸ˜Ž).

3. *Container*
   - Involves zooming into an individual system to reveal containers within. Examples include server-side applications, client-side applications, databases, etc.
   - not to be confused with Docker containers

4. *Component*
   - Dives deeper into an individual container to expose its components, like classes, interfaces or objects in your code.

** Diagram types
*** Level 1: Context diagram

Shows how your system fits into the larger system environment (system landscape). It basically shows *interactions*
between users and systems:
- e.g. A payment system interacting with an user and a banking system

#+begin_src plantuml :file (org-sbe puml-dir (filename \"c4-context-diagram.png\"))
@startuml ContextDiagram
title System Context diagram for Internet Banking System

actor Customer
actor BankEmployee
boundary InternetBanking
boundary EmailSystem
boundary MainframeBanking

BankEmployee --> InternetBanking : Uses
InternetBanking --> EmailSystem : Sends email notifications
InternetBanking --> MainframeBanking : Fetches account details
Customer --> InternetBanking : Uses

@enduml
#+end_src

#+html: {{< gbox src="/posts/img/2023/documentation-as-code/c4-context-diagram.png" title="Context diagram" caption="Context diagram" pos="left" >}}


*** Level 2: Container diagram

Higher level view within a system itself. Shows software "containers" like web servers,
standalone apps, or databases. (e.g., An API server, a database, and a client app in a
single system)

#+begin_src plantuml :file (org-sbe puml-dir (filename \"c4-container-diagram.png\"))
@startuml ContainerDiagram
title Container diagram for Internet Banking System

actor Customer
actor BankEmployee
database "Database" as db
cloud "Email System"
[Web Application] as WebApp
[API Application] as ApiApp

Customer -- WebApp
BankEmployee -- WebApp
WebApp -- db
WebApp --> EmailSystem
db -- ApiApp

@enduml
#+end_src

#+html: {{< gbox src="/posts/img/2023/documentation-as-code/c4-container-diagram.png" title="Container diagram" caption="Container diagram" pos="left" >}}

*** Level 3: Component diagram

Shows internal parts of a container. Mostly used with complex software. (e.g.,
Controllers, services, repositories inside of a web application)

#+begin_src plantuml :file (org-sbe puml-dir (filename \"c4-component-diagram.png\"))
@startuml ComponentDiagram
title Component diagram for Web Application

class AccountController
class AccountService
class AccountRepository
interface "Logging Component" as Log

AccountController --> AccountService : Uses
AccountService ..> AccountRepository : Uses <<persist>>
AccountService --> Log : Uses
AccountRepository --> Log : Uses

@enduml
#+end_src

#+html: {{< gbox src="/posts/img/2023/documentation-as-code/c4-component-diagram.png" title="Component diagram" caption="Component diagram" pos="left" >}}

*** Level 4: Code diagram

A detailed view of the code level. For systems with little internal complexity, it can be
skipped. (e.g., UML class diagrams)

#+begin_src plantuml :file (org-sbe puml-dir (filename \"c4-code-diagram.png\"))
@startuml CodeDiagram
title UML class diagram for Service and Repository

class Account {
  +String holder
  +Double balance
}
class AccountDao {
  +void save(Account)
  +Account get(Long id)
}
AccountDao o--> Account

@enduml
#+end_src

#+html: {{< gbox src="/posts/img/2023/documentation-as-code/c4-code-diagram.png" title="Code diagram" caption="Code diagram" pos="left" >}}

* Structurizr DSL
Structurizr is used for /describing/ and /visualizing/ architecture using the C4 model.
** Installation


Using ~Docker~:
#+begin_src shell
#describe here how to run the Docker container
#+end_src

* Ilograph
Short
* Resources
*Tools*:

- 2023-10-05 â—¦ [[https://icepanel.io/blog/2022-10-03-c4-model-for-system-architecture-design?utm_source=dev_to&utm_medium=post&utm_campaign=should_you_use_c4][IcePanel.io]]

  A /visual/ modelling tool for C4
- 2023-10-05 â—¦ [[https://github.com/plantuml-stdlib/C4-PlantUML][C4-PlantUML]]

  #+begin_quote
  C4-PlantUML combines the benefits of PlantUML and the C4 model for providing a simple way of describing and communicate software architectures
  #+end_quote

*Articles*:
- 2023-10-08 â—¦ [[https://www.dandoescode.com/blog/c4-models-with-structurizr][Software Diagrams - C4 Models with Structurizr]]
- 2023-07-10 â—¦ [[https://practical.li/engineering-playbook/architecture/structurizr/][Structurizr - Practicalli Engineering Playbook]]
- 2022-10-31 â—¦ [[https://dev.to/icepanel/c4-model-for-system-architecture-design-16dh][C4 model for system architecture design]]
- 2022-10-10 â—¦ [[https://dev.to/indrive_tech/c4-models-architecture-from-simple-to-complex-38fk][C4 Models: Architecture From Simple ToÂ Complex]]

*Structurizr*:
- 2023-10-07 â—¦ [[https://www.structurizr.com/help/themes][Structurizr - Help - Themes]]

*Videos*:
- 2023-07-10 â—¦ [[https://www.youtube.com/watch?v=f7i2wxQVffk&list=PLEx5khR4g7PLf2kQn3nYaZJC2Zv2GPbnY&ab_channel=GOTOConferences][C4 Models as Code â€¢ Simon Brown â€¢ YOW! 2022 - YouTube]]


#+begin_src emacs-lisp :results silent :exports none
;; auto-export
(defun esf/execute-startup-block
	(org-hugo-auto-export-mode)

  ;; set buffer variable
  (setq org-agenda-files nil)

  ;; set-fill-column
  (setq-local fill-column 90)

  (add-to-list 'org-hugo-special-block-type-properties '("sidenote" . (:trim-pre t :trim-post t)))

  )
#+end_src

# Local Variables:
# eval: (esf/execute-startup-block)
# End:
